import{i as P,c as b,e as v,h as u,v as W,a as E,s as H,r as c,x as Q,o as R,b as e,d as o,w as n,k as K,l as X,y as Y,f as r,g as z,t as D,z as y}from"./index-CLO37vWr.js";const Z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ee=u("path",{d:"M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),te=u("path",{d:"M256 56v120a32 32 0 0 0 32 32h120",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),ne=u("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 288h160"},null,-1),oe=u("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 368h160"},null,-1),le=[ee,te,ne,oe],ae=P({name:"DocumentTextOutline",render:function(a,g){return v(),b("svg",Z,le)}}),se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},re=u("rect",{x:"48",y:"80",width:"416",height:"352",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),ue=u("circle",{cx:"336",cy:"176",r:"32",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),ie=u("path",{d:"M304 335.79l-90.66-90.49a32 32 0 0 0-43.87-1.3L48 352",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),de=u("path",{d:"M224 432l123.34-123.34a32 32 0 0 1 43.11-2L464 368",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),ce=[re,ue,ie,de],pe=P({name:"ImageOutline",render:function(a,g){return v(),b("svg",se,ce)}}),_e={style:{"margin-bottom":"12px"}},fe={style:{"margin-bottom":"12px"}},ve={__name:"ImportQuestion",setup(C){const{message:a}=W(["message"]),g=E(),{userId:f}=H(g),l=c(!1),x=c(!1),j=c([]),i=c(null),I=c("file"),d=c(""),T=Q(()=>j.value.map(s=>({label:s.name,value:s.id}))),N=async()=>{x.value=!0;try{j.value=await K.list(f.value)}catch(s){a.error(s.message||"加载科目列表失败")}finally{x.value=!1}},S=async({file:s})=>{if(!i.value){a.warning("请先选择科目");return}if(l.value){console.log("[前端] 正在导入中，跳过重复请求");return}l.value=!0;try{const t=await y.fromFile(f.value,i.value,s.file);a.success(t.message||"导入成功")}catch(t){a.error(t.message||"导入失败")}finally{l.value=!1}},U=async({file:s})=>{if(!i.value){a.warning("请先选择科目");return}if(l.value){console.log("[前端] 正在导入中，跳过重复请求");return}l.value=!0;try{const t=await y.fromImage(f.value,i.value,s.file);a.success(t.message||"导入成功")}catch(t){a.error(t.message||"导入失败")}finally{l.value=!1}},V=async()=>{if(!i.value){a.warning("请先选择科目");return}if(!d.value.trim()){a.warning("请输入题目文本");return}l.value=!0;try{const s=await y.fromText({user_id:f.value,subject_id:i.value,text:d.value});a.success(s.message||"导入成功"),d.value=""}catch(s){a.error(s.message||"导入失败")}finally{l.value=!1}};return R(()=>{N()}),(s,t)=>{const O=o("n-page-header"),F=o("n-select"),w=o("n-card"),m=o("n-alert"),A=o("n-icon"),k=o("n-text"),B=o("n-p"),M=o("n-upload-dragger"),$=o("n-upload"),p=o("n-space"),h=o("n-tab-pane"),G=o("n-input"),q=o("n-button"),J=o("n-tabs"),L=o("n-progress");return v(),b("div",null,[e(O,{title:"导入题目",subtitle:"通过文件、图片或文本导入题目，AI 自动解析"}),e(p,{vertical:"",size:"large",style:{"margin-top":"24px"}},{default:n(()=>[e(w,{title:"1. 选择科目"},{default:n(()=>[e(F,{value:i.value,"onUpdate:value":t[0]||(t[0]=_=>i.value=_),options:T.value,placeholder:"请选择科目",loading:x.value},null,8,["value","options","loading"])]),_:1}),e(w,{title:"2. 选择导入方式"},{default:n(()=>[e(J,{value:I.value,"onUpdate:value":t[2]||(t[2]=_=>I.value=_),type:"segment"},{default:n(()=>[e(h,{name:"file",tab:"文件导入"},{default:n(()=>[e(p,{vertical:"",style:{"margin-top":"16px"}},{default:n(()=>[e(m,{type:"info"},{default:n(()=>[...t[3]||(t[3]=[r(" 支持 PDF、Word、文本文件。AI 将自动识别题目、选项、答案和解析。 ",-1)])]),_:1}),e($,{"custom-request":S,"show-file-list":!1,disabled:l.value,accept:".pdf,.docx,.doc,.txt"},{default:n(()=>[e(M,null,{default:n(()=>[u("div",_e,[e(A,{size:"48",depth:3},{default:n(()=>[e(z(ae))]),_:1})]),e(k,{style:{"font-size":"16px"}},{default:n(()=>[r(D(l.value?"正在导入...":"点击或拖拽文件到此区域上传"),1)]),_:1}),e(B,{depth:"3",style:{margin:"8px 0 0 0"}},{default:n(()=>[...t[4]||(t[4]=[r(" 支持 PDF、Word (.docx, .doc)、文本 (.txt) 格式 ",-1)])]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}),e(h,{name:"image",tab:"图片导入"},{default:n(()=>[e(p,{vertical:"",style:{"margin-top":"16px"}},{default:n(()=>[e(m,{type:"info"},{default:n(()=>[...t[5]||(t[5]=[r(" 支持 JPG、PNG 等图片格式。系统将使用 AI 视觉模型直接识别图片中的题目。 ",-1)])]),_:1}),e($,{"custom-request":U,"show-file-list":!1,disabled:l.value,accept:"image/*"},{default:n(()=>[e(M,null,{default:n(()=>[u("div",fe,[e(A,{size:"48",depth:3},{default:n(()=>[e(z(pe))]),_:1})]),e(k,{style:{"font-size":"16px"}},{default:n(()=>[r(D(l.value?"正在导入...":"点击或拖拽图片到此区域上传"),1)]),_:1}),e(B,{depth:"3",style:{margin:"8px 0 0 0"}},{default:n(()=>[...t[6]||(t[6]=[r(" 支持 JPG、PNG、BMP 等图片格式 ",-1)])]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}),e(h,{name:"text",tab:"文本导入"},{default:n(()=>[e(p,{vertical:"",style:{"margin-top":"16px"}},{default:n(()=>[e(m,{type:"info"},{default:n(()=>[...t[7]||(t[7]=[r(" 直接粘贴题目文本，AI 将自动解析题目结构。 ",-1)])]),_:1}),e(G,{value:d.value,"onUpdate:value":t[1]||(t[1]=_=>d.value=_),type:"textarea",placeholder:`请粘贴题目内容，例如：

1. 1+1等于多少？
A. 1
B. 2
C. 3
D. 4
答案：B
解析：基础加法运算`,rows:10},null,8,["value"]),e(q,{type:"primary",loading:l.value,disabled:!d.value||!i.value,onClick:V,block:""},{default:n(()=>[...t[8]||(t[8]=[r(" 开始导入 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),l.value?(v(),X(w,{key:0,title:"导入进度"},{default:n(()=>[e(p,{vertical:""},{default:n(()=>[e(L,{type:"line",percentage:100,processing:""}),e(k,null,{default:n(()=>[...t[9]||(t[9]=[r("正在使用 AI 解析题目，请稍候...",-1)])]),_:1}),e(m,{type:"warning",style:{"margin-top":"12px"}},{default:n(()=>[...t[10]||(t[10]=[r(" AI 识别可能需要 30-120 秒，请耐心等待，不要关闭页面 ",-1)])]),_:1})]),_:1})]),_:1})):Y("",!0)]),_:1})])}}};export{ve as default};
