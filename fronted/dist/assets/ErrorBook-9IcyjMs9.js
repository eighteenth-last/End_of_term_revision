import{u as J,j as K,a as Q,s as W,r as _,x as X,o as Y,c as f,b as t,w as e,d as s,k as ee,C as k,e as c,f as o,g as te,D as ne,t as r,l as y,F as S,m as T,y as ae,E as se}from"./index-CLO37vWr.js";const le={key:1,style:{display:"grid","grid-template-columns":"repeat(auto-fill, minmax(450px, 475px))",gap:"24px",padding:"8px"}},ce={__name:"ErrorBook",setup(oe){const d=J(),B=K(),D=Q(),{userId:w}=W(D),g=_(!1),C=_([]),v=_([]),z=_(0),m=_(null),V=X(()=>C.value.map(n=>({label:n.name,value:n.id}))),A=n=>({single:"单选题",multiple:"多选题",judge:"判断题",fill:"填空题"})[n]||n,M=(n,a)=>{var p;const h=((p=n.match(/^([A-Z])\./))==null?void 0:p[1])||n;return a.includes(h)},N=async()=>{try{C.value=await ee.list(w.value)}catch(n){d.error(n.message||"加载科目列表失败")}},x=async()=>{g.value=!0;try{const n={user_id:w.value};m.value&&(n.subject_id=m.value),v.value=await k.list(n);const a=await k.count(n);z.value=a.count}catch(n){d.error(n.message||"加载错题失败")}finally{g.value=!1}},O=n=>{B.warning({title:"确认移除",content:"确定要从错题集中移除这道题吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await k.remove(n),d.success("已移除"),x()}catch(a){d.error(a.message||"移除失败")}}})};return Y(()=>{N(),x()}),(n,a)=>{const h=s("n-icon"),p=s("n-button"),u=s("n-space"),$=s("n-page-header"),F=s("n-select"),i=s("n-text"),L=s("n-empty"),U=s("n-avatar"),j=s("n-tag"),q=s("n-alert"),I=s("n-collapse-item"),P=s("n-collapse"),R=s("n-scrollbar"),E=s("n-card"),Z=s("n-spin");return c(),f("div",null,[t($,{title:"错题集",subtitle:"查看和管理你的错题"},{extra:e(()=>[t(u,null,{default:e(()=>[t(p,{type:"primary",onClick:a[0]||(a[0]=l=>n.$router.push("/error-practice"))},{icon:e(()=>[t(h,null,{default:e(()=>[t(te(ne))]),_:1})]),default:e(()=>[a[2]||(a[2]=o(" 错题练习 ",-1))]),_:1})]),_:1})]),_:1}),t(E,{style:{"margin-top":"24px"}},{default:e(()=>[t(u,{vertical:"",size:"large"},{default:e(()=>[t(u,null,{default:e(()=>[t(F,{value:m.value,"onUpdate:value":[a[1]||(a[1]=l=>m.value=l),x],options:V.value,placeholder:"筛选科目",clearable:"",style:{width:"200px"}},null,8,["value","options"]),t(i,{depth:"3"},{default:e(()=>[o("共 "+r(z.value)+" 道错题",1)]),_:1})]),_:1}),t(Z,{show:g.value},{default:e(()=>[v.value.length===0?(c(),y(L,{key:0,description:"太棒了！目前没有错题",style:{"margin-top":"60px"}})):(c(),f("div",le,[(c(!0),f(S,null,T(v.value,(l,G)=>(c(),y(E,{key:l.error_id,hoverable:"",style:{height:"460px",display:"flex","flex-direction":"column"}},{header:e(()=>[t(u,{align:"center"},{default:e(()=>[t(U,{size:"small",style:{"background-color":"#18a058"}},{default:e(()=>[o(r(G+1),1)]),_:2},1024),t(i,{strong:""},{default:e(()=>[o(r(A(l.type)),1)]),_:2},1024),t(j,{type:"error",size:"small"},{default:e(()=>[o("错误 "+r(l.wrong_count)+" 次",1)]),_:2},1024)]),_:2},1024)]),"header-extra":e(()=>[t(p,{text:"",type:"error",size:"small",onClick:se(b=>O(l.error_id),["stop"]),style:{"margin-left":"16px"}},{default:e(()=>[...a[3]||(a[3]=[o(" 移除 ",-1)])]),_:1},8,["onClick"])]),footer:e(()=>[t(i,{depth:"3",style:{"font-size":"12px"}},{default:e(()=>[o(" 最后错误时间："+r(l.last_wrong_at),1)]),_:2},1024)]),default:e(()=>[t(R,{style:{"max-height":"330px"}},{default:e(()=>[t(u,{vertical:"",size:"large"},{default:e(()=>[t(i,{strong:"",style:{"font-size":"15px","line-height":"1.6"}},{default:e(()=>[o(r(l.question),1)]),_:2},1024),l.type!=="fill"?(c(),y(u,{key:0,vertical:"",size:"small"},{default:e(()=>[(c(!0),f(S,null,T(l.options,(b,H)=>(c(),y(i,{key:H,type:M(b,l.answer)?"success":"default",style:{"line-height":"1.8"}},{default:e(()=>[o(r(b),1)]),_:2},1032,["type"]))),128))]),_:2},1024)):ae("",!0),t(u,{align:"center"},{default:e(()=>[t(i,{depth:"3"},{default:e(()=>[...a[4]||(a[4]=[o("正确答案：",-1)])]),_:1}),t(j,{type:"success",size:"small"},{default:e(()=>[o(r(l.answer),1)]),_:2},1024)]),_:2},1024),t(P,{accordion:""},{default:e(()=>[t(I,{title:"查看解析",name:"analysis"},{default:e(()=>[t(q,{type:"info",style:{"font-size":"14px"}},{default:e(()=>[o(r(l.analysis),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]))]),_:1},8,["show"])]),_:1})]),_:1})])}}};export{ce as default};
