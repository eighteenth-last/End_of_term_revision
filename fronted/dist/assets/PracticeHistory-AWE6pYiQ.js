import{u as ie,a as ce,s as de,r as d,x as E,o as pe,c as b,b as t,d as o,w as e,k as _e,I as O,e as u,f as n,g as fe,l as v,y as J,F as Q,m as R,h,J as ve,t as r}from"./index-CLO37vWr.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as me}from"./RefreshOutline-Bgy7ErIL.js";const ge={style:{display:"flex","align-items":"center","justify-content":"space-between",width:"100%",padding:"8px 0"}},xe={style:{display:"flex","align-items":"center",flex:"1",gap:"16px"}},we={style:{flex:"1"}},be={style:{display:"flex","align-items":"center",gap:"12px","margin-bottom":"12px"}},he={style:{"margin-left":"24px"}},ke={key:2,style:{"margin-top":"16px","text-align":"center"}},ze={__name:"PracticeHistory",setup(Ce){const S=ie(),Z=ce(),{userId:B}=de(Z),D=d(!1),M=d(!1),T=d(!1),V=d(!1),i=d([]),U=d([]),k=d([]),x=d(null),w=d(50),F=d(!0),K=E(()=>[{label:"全部科目",value:null},...U.value.map(s=>({label:s.name,value:s.id}))]),z=E(()=>{if(i.value.length===0)return{totalSessions:0,totalQuestions:0,avgAccuracy:0,maxAccuracy:0};const s=i.value.reduce((y,m)=>y+m.total,0),a=i.value.reduce((y,m)=>y+m.correct,0),c=s>0?(a/s*100).toFixed(2):0,p=Math.max(...i.value.map(y=>y.accuracy));return{totalSessions:i.value.length,totalQuestions:s,avgAccuracy:c,maxAccuracy:p}}),W=s=>({A:"#18a058",B:"#2080f0",C:"#f0a020",D:"#d03050",F:"#d03050"})[s]||"#d03050",X=s=>s==="A"?"success":s==="B"?"info":s==="C"||s==="D"?"warning":"error",Y=s=>({single:"单选题",multiple:"多选题",judge:"判断题",fill:"填空题"})[s]||s,ee=(s,a)=>{var p;const c=((p=s.match(/^([A-Z])\./))==null?void 0:p[1])||s;return a.includes(c)},te=async s=>{T.value=!0,V.value=!0,k.value=[];try{const a=await O.get(`/api/practice/session/${s}/details`);k.value=a.data.details}catch{S.error("加载详情失败")}finally{T.value=!1}},ae=async()=>{try{U.value=await _e.list(B.value)}catch(s){console.error("加载科目列表失败:",s)}},I=async()=>{var s,a;D.value=!0,w.value=50;try{const c={user_id:B.value,limit:w.value};x.value&&(c.subject_id=x.value);const p=await O.get("/api/practice/history",{params:c});i.value=p.data.records,F.value=p.data.records.length>=w.value}catch(c){S.error(((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.message)||"加载练习记录失败")}finally{D.value=!1}},se=async()=>{M.value=!0,w.value+=50;try{const s={user_id:B.value,limit:w.value};x.value&&(s.subject_id=x.value);const a=await O.get("/api/practice/history",{params:s});i.value=a.data.records,F.value=a.data.records.length>=w.value}catch{S.error("加载更多失败")}finally{M.value=!1}};return pe(async()=>{await ae(),await I()}),(s,a)=>{const c=o("n-page-header"),p=o("n-select"),y=o("n-icon"),m=o("n-button"),g=o("n-space"),N=o("n-card"),G=o("n-empty"),le=o("n-avatar"),_=o("n-text"),C=o("n-tag"),f=o("n-statistic"),H=o("n-divider"),P=o("n-list-item"),$=o("n-list"),q=o("n-spin"),j=o("n-gi"),ne=o("n-grid"),oe=o("n-alert"),ue=o("n-modal");return u(),b("div",null,[t(c,{title:"做题记录",subtitle:"查看你的练习历史"}),t(g,{vertical:"",size:"large",style:{"margin-top":"24px"}},{default:e(()=>[t(N,null,{default:e(()=>[t(g,null,{default:e(()=>[t(p,{value:x.value,"onUpdate:value":[a[0]||(a[0]=l=>x.value=l),I],options:K.value,placeholder:"全部科目",style:{width:"200px"},clearable:""},null,8,["value","options"]),t(m,{onClick:I},{icon:e(()=>[t(y,null,{default:e(()=>[t(fe(me))]),_:1})]),default:e(()=>[a[2]||(a[2]=n(" 刷新 ",-1))]),_:1})]),_:1})]),_:1}),t(N,{title:"练习记录"},{default:e(()=>[t(q,{show:D.value},{default:e(()=>[i.value.length===0?(u(),v(G,{key:0,description:"暂无练习记录",style:{margin:"40px 0"}})):(u(),v($,{key:1,bordered:""},{default:e(()=>[(u(!0),b(Q,null,R(i.value,(l,A)=>(u(),v(P,{key:A},{default:e(()=>[h("div",ge,[h("div",xe,[t(le,{style:ve({backgroundColor:W(l.grade),fontSize:"20px",width:"48px",height:"48px"})},{default:e(()=>[n(r(l.grade),1)]),_:2},1032,["style"]),h("div",we,[h("div",be,[t(_,{strong:"",style:{"font-size":"18px"}},{default:e(()=>[n(r(l.subject_name),1)]),_:2},1024),t(C,{type:X(l.grade),size:"medium"},{default:e(()=>[n(r(l.grade)+" 级 ",1)]),_:2},1032,["type"]),t(_,{depth:"3",style:{"font-size":"14px","margin-left":"auto"}},{default:e(()=>[n(r(l.practice_date),1)]),_:2},1024)]),t(g,null,{default:e(()=>[t(f,{label:"总题数",value:l.total,style:{"min-width":"80px"}},{suffix:e(()=>[...a[3]||(a[3]=[n("题",-1)])]),_:1},8,["value"]),t(H,{vertical:""}),t(f,{label:"正确",value:l.correct,style:{"min-width":"80px"}},{suffix:e(()=>[t(_,{type:"success"},{default:e(()=>[...a[4]||(a[4]=[n("题",-1)])]),_:1})]),_:1},8,["value"]),t(H,{vertical:""}),t(f,{label:"错误",value:l.wrong,style:{"min-width":"80px"}},{suffix:e(()=>[t(_,{type:"error"},{default:e(()=>[...a[5]||(a[5]=[n("题",-1)])]),_:1})]),_:1},8,["value"]),t(H,{vertical:""}),t(f,{label:"正确率",value:l.accuracy,style:{"min-width":"100px"}},{suffix:e(()=>[t(_,{type:l.accuracy>=60?"success":"error"},{default:e(()=>[...a[6]||(a[6]=[n("%",-1)])]),_:1},8,["type"])]),_:2},1032,["value"])]),_:2},1024)])]),h("div",he,[t(m,{type:"primary",size:"large",onClick:L=>te(l.session_id)},{default:e(()=>[...a[7]||(a[7]=[n(" 查看详情 ",-1)])]),_:1},8,["onClick"])])])]),_:2},1024))),128))]),_:1})),i.value.length>0&&F.value?(u(),b("div",ke,[t(m,{onClick:se,loading:M.value},{default:e(()=>[...a[8]||(a[8]=[n(" 加载更多 ",-1)])]),_:1},8,["loading"])])):J("",!0)]),_:1},8,["show"])]),_:1}),t(N,{title:"练习统计"},{default:e(()=>[t(ne,{cols:"4","x-gap":"12",responsive:"screen"},{default:e(()=>[t(j,null,{default:e(()=>[t(f,{label:"总练习次数",value:z.value.totalSessions},{suffix:e(()=>[...a[9]||(a[9]=[n("次",-1)])]),_:1},8,["value"])]),_:1}),t(j,null,{default:e(()=>[t(f,{label:"总答题数",value:z.value.totalQuestions},{suffix:e(()=>[...a[10]||(a[10]=[n("题",-1)])]),_:1},8,["value"])]),_:1}),t(j,null,{default:e(()=>[t(f,{label:"平均正确率",value:z.value.avgAccuracy},{suffix:e(()=>[...a[11]||(a[11]=[n("%",-1)])]),_:1},8,["value"])]),_:1}),t(j,null,{default:e(()=>[t(f,{label:"最高正确率",value:z.value.maxAccuracy},{suffix:e(()=>[...a[12]||(a[12]=[n("%",-1)])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ue,{show:V.value,"onUpdate:show":a[1]||(a[1]=l=>V.value=l),preset:"card",title:"练习详情",style:{width:"90%","max-width":"1200px"}},{default:e(()=>[t(q,{show:T.value},{default:e(()=>[k.value.length===0?(u(),v(G,{key:0,description:"暂无详情数据"})):(u(),v($,{key:1,bordered:""},{default:e(()=>[(u(!0),b(Q,null,R(k.value,(l,A)=>(u(),v(P,{key:A},{default:e(()=>[t(g,{vertical:"",size:"large",style:{width:"100%"}},{default:e(()=>[t(g,{align:"center"},{default:e(()=>[t(C,{type:l.is_correct?"success":"error",size:"small"},{default:e(()=>[n(r(l.is_correct?"✓ 正确":"✗ 错误"),1)]),_:2},1032,["type"]),t(_,{strong:"",style:{"font-size":"15px"}},{default:e(()=>[n(r(A+1)+". ("+r(Y(l.type))+") "+r(l.question),1)]),_:2},1024)]),_:2},1024),l.type!=="fill"?(u(),v(g,{key:0,vertical:"",size:"small"},{default:e(()=>[(u(!0),b(Q,null,R(l.options,(L,re)=>(u(),v(_,{key:re,type:ee(L,l.correct_answer)?"success":"default"},{default:e(()=>[n(r(L),1)]),_:2},1032,["type"]))),128))]),_:2},1024)):J("",!0),t(g,null,{default:e(()=>[t(_,{depth:"3"},{default:e(()=>[...a[13]||(a[13]=[n("你的答案：",-1)])]),_:1}),t(C,{type:l.is_correct?"success":"error",size:"small"},{default:e(()=>[n(r(l.user_answer||"未作答"),1)]),_:2},1032,["type"]),t(_,{depth:"3"},{default:e(()=>[...a[14]||(a[14]=[n("正确答案：",-1)])]),_:1}),t(C,{type:"success",size:"small"},{default:e(()=>[n(r(l.correct_answer),1)]),_:2},1024)]),_:2},1024),t(oe,{type:"info",title:"解析"},{default:e(()=>[n(r(l.analysis),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1},8,["show"])]),_:1},8,["show"])])}}},Be=ye(ze,[["__scopeId","data-v-1b545fa0"]]);export{Be as default};
