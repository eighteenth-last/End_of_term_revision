# 神阁卷藏 - AI智能期末复习系统

<div align="center">
  <img src="./fronted/public/logo.png" alt="神阁卷藏Logo" width="200"/>
  
  [![Python](https://img.shields.io/badge/python-3.8%2B-blue.svg)](https://www.python.org/)
  [![Vue](https://img.shields.io/badge/vue-3.3.11-green.svg)](https://vuejs.org/)
  [![FastAPI](https://img.shields.io/badge/FastAPI-0.104.1-009688.svg)](https://fastapi.tiangolo.com/)
</div>

## 📖 项目简介

**神阁卷藏**是一款基于 AI 视觉模型的智能期末复习系统，通过先进的图像识别技术自动解析试题图片，支持多科目题库管理、智能练习、错题集、学习统计等功能，帮助学生高效备考。

### ✨ 核心特性

- 🤖 **AI 智能识别**：利用 OpenAI 视觉模型直接识别图片中的题目，无需 OCR
- 📐 **数学/物理公式支持**：完整支持 LaTeX 格式的数学和物理公式识别与渲染
- 📚 **多科目管理**：支持创建和管理多个科目的题库
- 🤝 **共享题库** ⭐NEW：支持将题库共享给指定用户或设为公共题库，学习数据完全隔离
- 🎯 **智能练习**：一次性展示所有题目，配备智能答题卡快速导航
- 📊 **学习统计**：实时统计今日、本周、全部学习数据，追踪学习进度
- 🔍 **错题集**：自动收集错题，支持针对性复习
- 📝 **练习记录**：详细记录每次练习的题目、答案、正确率
- 🎨 **现代化 UI**：基于 Naive UI 的优雅界面设计
- 🔐 **用户认证**：完整的注册登录系统，JWT 令牌认证
- 👥 **多用户隔离**：完整的用户数据隔离，每个用户拥有独立的数据空间

## 🖼️ 系统截图

### 首页统计
![首页](./img/Snipaste_2025-12-17_22-44-43.png)

### 科目管理
![科目管理](./img/Snipaste_2025-12-17_22-44-59.png)

### AI 智能导入
![AI导入题目](./img/Snipaste_2025-12-17_22-45-05.png)

### 题库管理
![题库管理](./img/Snipaste_2025-12-17_22-45-10.png)

### 智能练习
![开始练习](./img/Snipaste_2025-12-17_22-45-17.png)

### 错题集
![错题集](./img/Snipaste_2025-12-17_22-45-22.png)

### 练习记录
![练习记录](./img/Snipaste_2025-12-17_22-45-27.png)

### AI 模型配置
![AI配置](./img/Snipaste_2025-12-17_22-45-31.png)

## 🏗️ 技术架构

### 后端技术栈
- **框架**：FastAPI 0.104.1 / Uvicorn 0.24.0
- **数据库**：MySQL 8.0+ / SQLAlchemy 2.0.23
- **数据模型**：Pydantic 2.5.0
- **AI 模型**：OpenAI SDK 1.3.7（视觉与文本）
- **身份认证**：JWT (PyJWT) + bcrypt
- **文件/OCR**：Pillow、pdfplumber、python-docx、pytesseract
- **开发环境**：Python 3.8+

### 前端技术栈
- **框架**：Vue 3.3.11 (Composition API)
- **UI 组件**：Naive UI 2.35.0
- **公式渲染**：KaTeX（数学/物理公式）
- **构建工具**：Vite 5.0.8
- **路由管理**：Vue Router 4.2.5
- **状态管理**：Pinia 2.1.7
- **HTTP 客户端**：Axios 1.6.2
- **图标库**：@vicons/ionicons5

## 📦 项目结构

```
End_of_term_revision/
├── Server/                    # 后端服务
│   ├── app.py                # FastAPI 主应用
│   ├── routers/              # API 路由
│   │   ├── auth_router.py       # 用户认证
│   │   ├── subjects_router.py   # 科目管理
│   │   ├── questions_router.py  # 题目管理
│   │   ├── import_router.py     # AI 导入
│   │   ├── practice_router.py   # 练习功能
│   │   ├── error_router.py      # 错题集
│   │   ├── model_router.py      # 模型配置
│   │   └── resource_router.py   # 题目资源
│   ├── services/             # 业务逻辑层
│   │   ├── ai_parser.py         # AI 解析服务
│   │   ├── practice_service.py  # 练习服务
│   │   └── file_reader.py       # 文件读取
│   ├── database/             # 数据库相关
│   │   ├── models.py            # ORM 模型
│   │   ├── db.py                # 默认数据库连接
│   │   └── dynamic_db.py        # 动态数据库（如需扩展）
│   └── utils/                # 工具模块
│       ├── ai_client.py         # AI 客户端
│       └── schema_validator.py  # 数据验证
│
├── fronted/                   # 前端应用
│   ├── src/
│   │   ├── App.vue           # 根组件
│   │   ├── main.js           # 入口文件
│   │   ├── router/           # 路由配置
│   │   ├── api/              # API 接口
│   │   ├── views/            # 页面组件
│   │   │   ├── Home.vue         # 首页
│   │   │   ├── Subjects.vue     # 科目管理
│   │   │   ├── ImportQuestion.vue # AI 导入
│   │   │   ├── QuestionBank.vue # 题库管理
│   │   │   ├── Practice.vue     # 开始练习
│   │   │   ├── ErrorBook.vue    # 错题集
│   │   │   ├── ErrorPractice.vue # 错题练习
│   │   │   ├── PracticeHistory.vue # 练习记录
│   │   │   └── ModelConfig.vue  # AI 配置
│   │   ├── stores/           # 状态管理
│   │   │   └── user.js          # 用户状态
│   │   └── assets/           # 静态资源
│   ├── package.json          # 前端依赖
│   └── vite.config.js        # Vite 配置
│
├── database/                  # 数据库脚本
│   └── end_of_term_revision.sql  # 完整数据库结构
│
├── img/                       # 系统截图
└── README.md                  # 项目文档
```

## 🚀 快速开始

### 环境要求

- Python 3.8 或更高版本
- Node.js 18 或更高版本
- MySQL 8.0 或更高版本
- OpenAI API Key（用于 AI 视觉识别）

### 1. 数据库配置

创建 MySQL 数据库并导入表结构：

```bash
# 创建数据库
mysql -u root -p
CREATE DATABASE end_of_term_revision CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 导入数据库结构
mysql -u root -p end_of_term_revision < database/end_of_term_revision.sql
```

### 2. 后端配置

```bash
# 进入后端目录
cd Server

# 安装依赖
pip install -r requirements.txt

# 配置数据库连接
# 编辑 `Server/database/db.py` 文件，修改默认连接信息：
# DEFAULT_DATABASE_URL = "mysql+pymysql://用户名:密码@主机:端口/数据库名?charset=utf8mb4"
# 例如：DEFAULT_DATABASE_URL = "mysql+pymysql://root:password@localhost:3306/end_of_term_revision?charset=utf8mb4"

# 启动后端服务
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

后端服务将在 `http://localhost:8000` 启动

### 3. 前端配置

```bash
# 进入前端目录
cd fronted

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

前端应用将在 `http://localhost:3000` 启动，已通过 Vite 代理将 `/api` 代理到 `http://localhost:8000`

### 4. 系统初始化

首次使用需要进行以下配置：

1. 注册账号并登录
2. 在「配置」→「AI 模型配置」中填入 OpenAI API Key
3. 开始使用系统功能

## 📚 使用指南

### 📐 数学/物理公式支持说明

系统已完整支持 LaTeX 格式的数学和物理公式，可自动识别和精确渲染：

**✅ 支持的公式类型：**
- **数学公式**：分式、根式、上下标、积分、求和、极限等
- **物理公式**：力学、电磁学、热力学等物理公式
- **希腊字母**：α (alpha)、β (beta)、γ (gamma)、θ (theta)、π (pi) 等
- **特殊符号**：向量、矩阵、方程组等

**📝 示例：**
- 行内公式：已知函数 $f(x)=x^2+2x+1$，求其最小值
- 独立公式：$$\\int_0^1 x^2 dx = \\frac{1}{3}$$
- 物理公式：牛顿第二定律 $F=ma$
- 复杂公式：二次方程求根公式 $$x = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$$

**🤖 AI 自动识别：**
- 上传包含数学/物理公式的图片时，AI 会自动将公式转换为 LaTeX 格式
- 前端使用 KaTeX 引擎实时渲染，显示为标准数学排版
- 支持题干、选项、答案、解析中的公式

**💡 注意事项：**
- 确保图片中的公式清晰可辨
- 复杂公式建议上传高分辨率图片
- AI 识别后可手动编辑 LaTeX 代码进行微调

### 1️⃣ 科目管理
- 点击「科目管理」添加需要复习的科目
- 每个科目独立管理题目和练习记录
- 支持编辑和删除科目

### 2️⃣ AI 智能导入题目
- 在「导入题目」页面选择科目
- 上传包含题目的清晰图片（支持 JPG、PNG 等格式）
- AI 自动识别题型（单选/多选/判断）、题干、选项和答案
- 预览并确认导入，可编辑题目内容和解析

💡 **提示**：图片清晰度越高，识别准确率越高

### 3️⃣ 题库管理
- 查看所有导入的题目
- 按科目、题型筛选
- 支持关键词搜索
- 编辑或删除题目

### 📚 练习系统

1. **开始练习**：
   - 选择科目（包括自己的和共享的科目）
   - 选择题型和题目数量
   - 点击"开始练习"

2. **答题界面**：
   - 左侧为题目区域，支持下滑浏览
   - 右侧为答题卡快速导航
   - 支持公式渲染（LaTeX 格式）

3. **提交答案**：
   - 自动判分，显示正确率和成绩等级
   - 错题自动加入错题集
   - 详细的题目解析

4. **错题练习**：
   - 从错题集中筛选题目
   - 支持按科目和题型筛选
   - 重新练习巩固薄弱环节

### 🤝 共享题库 ⭐NEW

#### 共享你的题库

1. **打开共享设置**：
   - 进入「科目管理」页面
   - 找到要共享的科目
   - 点击右上角菜单 ⋯，选择「共享设置」

2. **选择共享方式**：
   
   **方式一：指定用户共享**
   - 选择「指定用户」
   - 在搜索框输入用户名
   - 从下拉列表选择用户
   - 点击「添加共享」
   
   **方式二：公共共享**
   - 选择「公共共享」
   - 点击「添加共享」
   - 该科目将对所有用户可见

3. **管理共享**：
   - 在「当前共享」列表中查看所有共享记录
   - 点击「取消共享」可撤销共享权限
   - 科目卡片显示 **✨ 已共享** 标识

#### 使用共享题库

1. **查看共享科目**：
   - 在「科目管理」页面自动显示：
     - 🤝 **共享** - 他人共享给你的科目
     - 🌍 **公共** - 公共题库
   - 显示题库来源用户名

2. **练习共享题目**：
   - 点击共享科目即可查看题目
   - 在「开始练习」中选择共享科目进行练习
   - 练习数据归属你自己，不影响题库拥有者

3. **权限说明**：
   - ✅ 可以查看题目内容
   - ✅ 可以使用题目练习
   - ✅ 练习记录和错题集独立存储
   - ❌ 不能编辑或删除共享题目
   - ❌ 不能修改共享科目

#### 数据隔离保证

- **题目数据**：共享科目的题目可以被访问
- **学习数据**：完全隔离，包括：
  - 练习会话记录
  - 每道题的答题记录
  - 错题集
  - 学习统计数据

**举例说明**：
- 用户A创建「高等数学」题库并共享给用户B
- 用户B可以使用这些题目练习
- 用户B的练习记录、错题只属于用户B
- 用户A的学习数据不受任何影响

### 6️⃣ 学习统计
- 首页显示今日、本周、全部统计
- 练习次数、正确率、等级评定
- 连续学习天数追踪
- 查看每次练习的详细记录

## 📊 等级评价标准

| 等级 | 正确率 | 说明 |
|------|--------|------|
| A | ≥90% | 优秀 |
| B | 80-89% | 良好 |
| C | 70-79% | 中等 |
| D | 60-69% | 及格 |
| F | <60% | 不及格 |

## 🔧 API 接口文档

后端启动后访问 `http://localhost:8000/docs` 查看完整的 API 文档（Swagger UI）

主要接口：

- **认证接口**：`/api/auth/` - 注册、登录
- **科目接口**：`/api/subjects/` - CRUD 操作
- **题目接口**：`/api/questions/` - 题库管理
- **导入接口**：`/api/import/` - AI 解析题目
- **练习接口**：`/api/practice/` - 练习功能
- **错题接口**：`/api/errors/` - 错题集管理
- **配置接口**：`/api/models/` - AI 模型配置
- **资源接口**：`/api/resources/` - 题目图片、表格等资源管理

## 🛠️ 开发说明

### 数据库模型

主要数据表：
- `users` - 用户表
- `subjects` - 科目表
- `questions` - 题目表
- `practice_sessions` - 练习会话表
- `practice_records` - 练习记录表
- `error_questions` - 错题表
- `model_configs` - AI 模型配置表
- `db_configs` - 数据库配置表

### AI 识别流程

1. 用户上传图片 → 2. 图片转 base64 编码 → 3. 调用 OpenAI Vision API → 4. AI 返回结构化 JSON → 5. 数据验证和规范化 → 6. 存入数据库

### 前端路由

| 路径 | 页面 | 说明 |
|------|------|------|
| `/` | 首页 | 学习统计数据 |
| `/subjects` | 科目管理 | 管理科目 |
| `/question-bank` | 题库管理 | 查看和编辑题目 |
| `/import` | 导入题目 | AI 智能识别 |
| `/practice` | 开始练习 | 练习界面 |
| `/errors` | 错题集 | 查看错题 |
| `/error-practice` | 错题练习 | 错题专项练习 |
| `/practice-history` | 练习记录 | 历史记录 |
| `/model-config` | AI 配置 | 模型配置 |

## ❓ 常见问题

### 1. 导入图片时提示超时，但后端正常导入了数据？

**问题原因：** AI 视觉模型识别图片需要较长时间（30-120秒），前端默认超时时间太短。

**解决方案：** 已在 v1.0.1 版本修复，前端超时时间已调整为 180 秒。如仍有问题，请检查：
- 网络连接是否稳定
- OpenAI API 响应速度
- 图片是否过大或过于复杂

### 2. 题库管理页面的题型筛选不生效？

**解决方案：** 已在 v1.0.1 版本修复。如需手动修复：
- 刷新浏览器缓存（Ctrl + F5）
- 重新部署前端代码

### 3. AI 识别准确率低怎么办？

**建议：**
- 确保图片清晰，分辨率足够
- 题目排版规范，避免手写或模糊字迹
- 一次上传的题目不要太多（建议 5-10 题）
- 可以在导入后手动编辑修正

### 4. 如何更换 AI 模型？

进入「配置」→「AI 模型配置」，可以配置：
- API Base URL（支持 OpenAI 兼容接口）
- API Key
- 模型名称（如 gpt-4-vision-preview）

### 5. 数据库连接失败？

**错误示例：** `Access denied for user 'admin'@'localhost'`

检查以下配置：
- MySQL 服务是否启动
- 编辑 `Server/database/db.py` 文件，确认数据库连接信息正确
  ```python
  DEFAULT_DATABASE_URL = "mysql+pymysql://用户名:密码@主机:端口/数据库名"
  ```
- 数据库是否已创建并导入表结构
- 数据库用户名和密码是否正确
- 用户是否有访问数据库的权限

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

1. Fork 本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 提交 Pull Request

## 📝 更新日志

### v1.5.0 (2025-12-22)

- 🤝 **共享题库功能** ⭐重大更新
  - **授权共享模式**：通过 `subject_shares` 表实现权限控制，无数据复制
  - **两种共享方式**：
    - 指定用户共享：可将题库共享给特定用户
    - 公共共享：将题库设为对所有用户可见
  - **完整权限体系**：
    - 拥有者：完整的编辑、删除、共享权限
    - 共享用户：只读访问，可查看题目和练习
    - 前后端双重权限控制
  - **数据隔离保证**：
    - 练习记录、错题集等学习数据严格归属当前用户
    - 共享只涉及题目内容，不影响个人学习数据
  - **UI 优化**：
    - 科目卡片清晰标识：📘 我的 / 🤝 共享 / 🌍 公共 / ✨ 已共享
    - 共享设置对话框，支持用户搜索和共享管理
    - 实时更新共享状态
  - **用户体验**：
    - 搜索用户时自动排除当前登录账户
    - 添加/取消共享后自动刷新状态
    - 支持查看我共享出去的科目列表

### v1.4.0 (2025-12-21)

- 📐 **数学/物理公式支持**
  - AI 识别阶段：数学和物理公式自动转换为 LaTeX 格式
  - 后端存储：LaTeX 字符串直接存入数据库，不破坏现有表结构
  - 前端渲染：引入 KaTeX 引擎，支持行内公式 `$...$` 和块级公式 `$$...$$`
  - 创建 FormulaRenderer 通用组件，统一处理公式渲染
  - 已集成到所有页面：题库管理、练习、错题集、练习记录
  - 支持分式、上下标、希腊字母、向量、积分、根号等完整 LaTeX 语法
- 🔧 **后端优化**
  - 更新 AI Prompt，明确要求公式输出为 LaTeX 格式
  - 禁止将公式转换为自然语言或使用其他格式
  - 数据校验层保持 LaTeX 字符不被转义
- 📚 **文档更新**
  - README 新增数学/物理公式支持说明
  - 提供公式示例和使用注意事项

### v1.3.0 (2025-12-19)

- 🔐 **完整的用户数据隔离**
  - 修复前端所有页面硬编码 userId 的问题
  - 创建全局 Pinia 状态管理 (user store)
  - 每个用户拥有完全独立的数据空间
  - 支持多用户同时使用系统
- 🗑️ **简化系统架构**
  - 删除数据库配置功能，简化用户操作
  - 统一在 `Server/database/db.py` 中配置数据库连接
  - 减少配置错误的可能性，提升系统稳定性
  

### v1.0.1 (2025-12-19)

- 🐛 修复 AI 导入超时问题
  - 前端全局超时从 30 秒增加到 120 秒
  - 图片/文件导入接口单独设置 180 秒超时
  - 添加用户友好的等待提示（30-120 秒）
- 🐛 修复题库管理页面题型筛选功能
  - 添加客户端题型过滤逻辑
  - 支持科目、题型、关键词组合筛选
- ✨ 全新登录体验
  - 登录注册改为首页弹窗形式，无需跳转
  - 未登录时显示空状态提示
  - 头部动态显示登录/用户信息
  - 弹窗强制登录，提升安全性
- 📈 优化用户体验
  - 导入过程中提示用户耐心等待
  - 防止用户在导入过程中关闭页面
  - 练习提交后自动跳转到练习记录页面（延迟 1.5 秒）
  - 支持普通练习和错题练习的自动跳转

### v1.0.0 (2025-12-17)

- ✨ 首次发布
- 🤖 AI 视觉模型直接识别题目
- 📚 多科目题库管理
- 🎯 智能练习系统
- 🔍 错题集功能
- 📊 学习统计
- 📝 练习记录详情
- 🎨 现代化 UI 设计
- 🔐 用户认证系统

## 👨‍💻 作者信息

- **作者**：程序员Eighteen
- **联系方式**：3273495516@qq.com
- **项目名称**：神阁卷藏 (End of Term Revision)

## 📄 许可证

本项目采用 MIT 许可证。

## 🙏 致谢

感谢以下开源项目：

- [FastAPI](https://fastapi.tiangolo.com/) - 现代化的 Python Web 框架
- [Vue.js](https://vuejs.org/) - 渐进式 JavaScript 框架
- [Naive UI](https://www.naiveui.com/) - 优雅的 Vue 3 组件库
- [OpenAI](https://openai.com/) - 强大的 AI 模型支持
- [SQLAlchemy](https://www.sqlalchemy.org/) - Python SQL 工具包

---

<div align="center">
  <p>如果这个项目对你有帮助，请给一个 ⭐️ Star！</p>
  <p>Made with ❤️ by Eighteen</p>
</div>
