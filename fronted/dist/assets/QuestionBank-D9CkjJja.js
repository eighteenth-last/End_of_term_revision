import{i as Z,c as p,e as i,h as f,u as we,j as xe,a as be,s as ke,r as _,x as $,o as Ce,b as e,d as s,w as t,k as ze,B as I,q as je,g as B,f as o,l as U,y as Q,F as K,m as F,t as u}from"./index-CLO37vWr.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{R as Te}from"./RefreshOutline-Bgy7ErIL.js";import{T as $e}from"./TrashOutline-D3PAmIE5.js";const Be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Oe=f("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Le=f("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),Me=[Oe,Le],Ue=Z({name:"EyeOutline",render:function(k,N){return i(),p("svg",Be,Me)}}),Qe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ne=f("path",{d:"M221.09 64a157.09 157.09 0 1 0 157.09 157.09A157.1 157.1 0 0 0 221.09 64z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),Pe=f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32",d:"M338.29 338.29L448 448"},null,-1),Ve=[Ne,Pe],Y=Z({name:"SearchOutline",render:function(k,N){return i(),p("svg",Qe,Ve)}}),De={style:{display:"flex","align-items":"center",gap:"8px"}},Ee={style:{"font-weight":"500"}},Re={key:0},Ae={style:{"margin-top":"8px"}},Ie={style:{"margin-top":"4px"}},Ke={style:{"margin-top":"8px"}},Fe={key:2,style:{"margin-top":"16px",display:"flex","justify-content":"flex-end"}},Ge={key:0},He={__name:"QuestionBank",setup(G){const k=we(),N=xe(),q=be(),{userId:P}=ke(q),V=_(!1),c=_([]),z=_([]),g=_(null),y=_(null),j=_(""),h=_(1),C=_(20),D=_(!1),r=_(null),ee=[{label:"单选题",value:"single"},{label:"多选题",value:"multiple"},{label:"判断题",value:"judge"},{label:"填空题",value:"fill"}],te=$(()=>z.value.map(n=>({label:n.name,value:n.id}))),H=$(()=>c.value.length),O=$(()=>{const n={};return c.value.forEach(l=>{n[l.type]=(n[l.type]||0)+1}),n}),le=$(()=>Math.ceil(H.value/C.value)),ne=$(()=>{const n=(h.value-1)*C.value,l=n+C.value;return c.value.slice(n,l)}),J=n=>({single:"info",multiple:"success",judge:"warning",fill:"error"})[n]||"default",W=n=>({single:"单选",multiple:"多选",judge:"判断",fill:"填空"})[n]||n,X=n=>{const l=z.value.find(d=>d.id===n);return l?l.name:"未知科目"},ae=async()=>{try{z.value=await ze.list(P.value)}catch{k.error("加载科目列表失败")}},w=async()=>{V.value=!0;try{const n={user_id:P.value};g.value&&(n.subject_id=g.value),y.value&&(n.question_type=y.value);const l=g.value?await I.list(n):[];if(!g.value&&z.value.length>0){const d=z.value.map(x=>I.list({user_id:P.value,subject_id:x.id})),m=await Promise.all(d);c.value=m.flat()}else c.value=l;if(y.value&&(c.value=c.value.filter(d=>d.type===y.value)),j.value){const d=j.value.toLowerCase();c.value=c.value.filter(m=>m.question.toLowerCase().includes(d)||m.answer.toLowerCase().includes(d)||m.analysis.toLowerCase().includes(d))}h.value=1}catch(n){k.error(n.message||"加载题目失败")}finally{V.value=!1}},se=()=>{g.value=null,y.value=null,j.value="",w()},oe=n=>{r.value=n,D.value=!0},ue=n=>{N.warning({title:"确认删除",content:`确定要删除题目「${n.question.substring(0,30)}...」吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await I.delete(n.id),k.success("删除成功"),w()}catch(l){k.error(l.message||"删除失败")}}})},ie=n=>{h.value=n},re=n=>{C.value=n,h.value=1};return Ce(()=>{ae().then(()=>{w()})}),(n,l)=>{const d=s("n-page-header"),m=s("n-select"),x=s("n-icon"),ce=s("n-input"),L=s("n-button"),v=s("n-space"),E=s("n-card"),S=s("n-statistic"),de=s("n-empty"),M=s("n-tag"),T=s("n-text"),pe=s("n-thing"),_e=s("n-list-item"),ve=s("n-list"),fe=s("n-pagination"),me=s("n-spin"),b=s("n-descriptions-item"),ge=s("n-descriptions"),ye=s("n-modal");return i(),p("div",null,[e(d,{title:"题库管理",subtitle:"查看和管理所有题目"}),e(v,{vertical:"",size:"large",style:{"margin-top":"24px"}},{default:t(()=>[e(E,null,{default:t(()=>[e(v,null,{default:t(()=>[e(m,{value:g.value,"onUpdate:value":[l[0]||(l[0]=a=>g.value=a),w],options:te.value,placeholder:"选择科目",style:{width:"200px"},clearable:""},null,8,["value","options"]),e(m,{value:y.value,"onUpdate:value":[l[1]||(l[1]=a=>y.value=a),w],options:ee,placeholder:"题目类型",style:{width:"150px"},clearable:""},null,8,["value"]),e(ce,{value:j.value,"onUpdate:value":l[2]||(l[2]=a=>j.value=a),placeholder:"搜索题目内容",style:{width:"300px"},clearable:"",onKeyup:je(w,["enter"])},{prefix:t(()=>[e(x,null,{default:t(()=>[e(B(Y))]),_:1})]),_:1},8,["value"]),e(L,{type:"primary",onClick:w},{icon:t(()=>[e(x,null,{default:t(()=>[e(B(Y))]),_:1})]),default:t(()=>[l[5]||(l[5]=o(" 搜索 ",-1))]),_:1}),e(L,{onClick:se},{icon:t(()=>[e(x,null,{default:t(()=>[e(B(Te))]),_:1})]),default:t(()=>[l[6]||(l[6]=o(" 重置 ",-1))]),_:1})]),_:1})]),_:1}),e(E,null,{default:t(()=>[e(v,null,{default:t(()=>[e(S,{label:"总题数",value:H.value},null,8,["value"]),e(S,{label:"单选题",value:O.value.single||0},null,8,["value"]),e(S,{label:"多选题",value:O.value.multiple||0},null,8,["value"]),e(S,{label:"判断题",value:O.value.judge||0},null,8,["value"]),e(S,{label:"填空题",value:O.value.fill||0},null,8,["value"])]),_:1})]),_:1}),e(E,{title:"题目列表"},{default:t(()=>[e(me,{show:V.value},{default:t(()=>[c.value.length===0?(i(),U(de,{key:0,description:"暂无题目数据",style:{margin:"40px 0"}})):(i(),U(ve,{key:1,bordered:""},{default:t(()=>[(i(!0),p(K,null,F(ne.value,(a,R)=>(i(),U(_e,{key:a.id},{prefix:t(()=>[e(M,{type:J(a.type),size:"small"},{default:t(()=>[o(u(W(a.type)),1)]),_:2},1032,["type"])]),default:t(()=>[e(pe,null,{header:t(()=>[f("div",De,[f("span",Ee,u((h.value-1)*C.value+R+1)+". "+u(a.question),1)])]),"header-extra":t(()=>[e(v,null,{default:t(()=>[e(L,{text:"",onClick:A=>oe(a)},{icon:t(()=>[e(x,null,{default:t(()=>[e(B(Ue))]),_:1})]),default:t(()=>[l[7]||(l[7]=o(" 查看 ",-1))]),_:1},8,["onClick"]),e(L,{text:"",type:"error",onClick:A=>ue(a)},{icon:t(()=>[e(x,null,{default:t(()=>[e(B($e))]),_:1})]),default:t(()=>[l[8]||(l[8]=o(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),description:t(()=>[e(v,{vertical:"",size:"small",style:{"margin-top":"8px"}},{default:t(()=>[a.options&&a.options.length>0?(i(),p("div",Re,[e(v,{vertical:"",size:"small"},{default:t(()=>[(i(!0),p(K,null,F(a.options,(A,he)=>(i(),p("div",{key:he,style:{"font-size":"14px"}},u(A),1))),128))]),_:2},1024)])):Q("",!0),f("div",Ae,[e(T,{strong:""},{default:t(()=>[...l[9]||(l[9]=[o("答案：",-1)])]),_:1}),e(T,{type:"success"},{default:t(()=>[o(u(a.answer),1)]),_:2},1024)]),f("div",Ie,[e(T,{strong:""},{default:t(()=>[...l[10]||(l[10]=[o("解析：",-1)])]),_:1}),e(T,{depth:"3"},{default:t(()=>[o(u(a.analysis),1)]),_:2},1024)]),f("div",Ke,[e(v,{size:"small"},{default:t(()=>[e(M,{size:"tiny",bordered:!1},{default:t(()=>[o(" 科目: "+u(X(a.subject_id)),1)]),_:2},1024),e(M,{size:"tiny",bordered:!1},{default:t(()=>[o(" 创建时间: "+u(a.created_at),1)]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})),c.value.length>0?(i(),p("div",Fe,[e(fe,{page:h.value,"onUpdate:page":[l[3]||(l[3]=a=>h.value=a),ie],"page-count":le.value,"page-size":C.value,"show-size-picker":"","page-sizes":[10,20,50,100],"onUpdate:pageSize":re},null,8,["page","page-count","page-size"])])):Q("",!0)]),_:1},8,["show"])]),_:1})]),_:1}),e(ye,{show:D.value,"onUpdate:show":l[4]||(l[4]=a=>D.value=a),preset:"dialog",title:"题目详情",style:{width:"700px"}},{default:t(()=>[r.value?(i(),p("div",Ge,[e(v,{vertical:"",size:"large"},{default:t(()=>[e(ge,{"label-placement":"left",column:1,bordered:""},{default:t(()=>[e(b,{label:"题目类型"},{default:t(()=>[e(M,{type:J(r.value.type)},{default:t(()=>[o(u(W(r.value.type)),1)]),_:1},8,["type"])]),_:1}),e(b,{label:"所属科目"},{default:t(()=>[o(u(X(r.value.subject_id)),1)]),_:1}),e(b,{label:"题目内容"},{default:t(()=>[o(u(r.value.question),1)]),_:1}),r.value.options&&r.value.options.length>0?(i(),U(b,{key:0,label:"选项"},{default:t(()=>[e(v,{vertical:"",size:"small"},{default:t(()=>[(i(!0),p(K,null,F(r.value.options,(a,R)=>(i(),p("div",{key:R},u(a),1))),128))]),_:1})]),_:1})):Q("",!0),e(b,{label:"正确答案"},{default:t(()=>[e(T,{type:"success",strong:""},{default:t(()=>[o(u(r.value.answer),1)]),_:1})]),_:1}),e(b,{label:"题目解析"},{default:t(()=>[o(u(r.value.analysis),1)]),_:1}),e(b,{label:"创建时间"},{default:t(()=>[o(u(r.value.created_at),1)]),_:1})]),_:1})]),_:1})])):Q("",!0)]),_:1},8,["show"])])}}},Ze=Se(He,[["__scopeId","data-v-c21559e2"]]);export{Ze as default};
