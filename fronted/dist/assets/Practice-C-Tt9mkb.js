import{u as oe,a as ie,s as re,r,x as V,o as ce,c as f,b as n,l as y,d as u,w as a,h as E,k as de,A as ve,e as s,y as pe,f as w,F as k,m as j,t as L,B as _e,p as P}from"./index-CLO37vWr.js";const me={key:1,style:{display:"flex",gap:"16px","margin-top":"24px"}},fe={style:{flex:"1"}},ge={key:0},ye={key:1},be={style:{width:"300px",position:"sticky",top:"24px","align-self":"flex-start"}},he={style:{display:"grid","grid-template-columns":"repeat(5, 1fr)",gap:"8px"}},je={__name:"Practice",setup(we){const b=oe(),R=ve(),D=ie(),{userId:x}=re(D),z=r(!1),A=r(!1),U=r(!1),N=r(!1),O=r([]),C=r([]),$=r([]),g=r([]),c=r({}),d=r({}),v=r({subject_id:null,question_counts:{single:0,multiple:0,judge:0,fill:0}}),Q=[{label:"单选题",value:"single"},{label:"多选题",value:"multiple"},{label:"判断题",value:"judge"},{label:"填空题",value:"fill"}],Z=V(()=>O.value.map(t=>({label:t.name,value:t.id}))),G=V(()=>{let t=0;return g.value.forEach(e=>{e.type==="multiple"?d.value[e.id]&&d.value[e.id].length>0&&t++:c.value[e.id]&&t++}),t}),H=V(()=>v.value.subject_id?Object.values(v.value.question_counts).reduce((e,i)=>e+i,0)>0:!1),J=t=>({single:"单选题",multiple:"多选题",judge:"判断题",fill:"填空题"})[t]||t,M=t=>{const e=t.match(/^([A-Z])\./);return e?e[1]:t},K=t=>{const e=g.value[t];return e?e.type==="multiple"?d.value[e.id]&&d.value[e.id].length>0:c.value[e.id]&&c.value[e.id].trim()!=="":!1},W=async()=>{z.value=!0;try{O.value=await de.list(x.value)}catch(t){b.error(t.message||"加载科目列表失败")}finally{z.value=!1}},X=async t=>{try{const e=await _e.getTypes(t,x.value);C.value=e.types,$.value=[],v.value.question_counts={single:0,multiple:0,judge:0,fill:0}}catch(e){b.error(e.message||"获取题型失败")}},Y=async()=>{A.value=!0;try{const t=await P.start({user_id:x.value,subject_id:v.value.subject_id,question_counts:v.value.question_counts});g.value=t.questions,N.value=!0;const e={},i={};t.questions.forEach(p=>{p.type==="multiple"?i[p.id]=[]:e[p.id]=""}),c.value=e,d.value=i}catch(t){b.error(t.message||"开始练习失败")}finally{A.value=!1}},q=t=>{const e=document.getElementById(`question-${t}`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})},ee=async()=>{const t=g.value.filter(e=>e.type==="multiple"?!d.value[e.id]||d.value[e.id].length===0:!c.value[e.id]);if(t.length>0){b.warning(`还有 ${t.length} 题未作答`);return}U.value=!0;try{const e=g.value.map(p=>{let h="";return p.type==="multiple"?h=(d.value[p.id]||[]).sort().join(","):h=c.value[p.id]||"",{question_id:p.id,user_answer:h}}),i=await P.submit({user_id:x.value,subject_id:v.value.subject_id,answers:e});b.success(`提交成功！正确 ${i.correct} 题，错误 ${i.wrong} 题，准确率 ${i.accuracy}%，成绩 ${i.grade}`),setTimeout(()=>{R.push("/practice-history")},1500)}catch(e){b.error(e.message||"提交失败")}finally{U.value=!1}};return ce(()=>{W()}),(t,e)=>{const i=u("n-page-header"),p=u("n-select"),h=u("n-form-item"),te=u("n-alert"),F=u("n-checkbox"),le=u("n-input-number"),_=u("n-space"),I=u("n-checkbox-group"),T=u("n-button"),S=u("n-card"),ae=u("n-text"),ne=u("n-radio"),se=u("n-radio-group"),ue=u("n-input");return s(),f("div",null,[n(i,{title:"开始练习",subtitle:"自定义题量，开始你的练习"}),N.value?(s(),f("div",me,[E("div",fe,[n(_,{vertical:"",size:"large"},{default:a(()=>[(s(!0),f(k,null,j(g.value,(l,m)=>(s(),y(S,{key:l.id,title:`${m+1}.(${J(l.type)}) ${l.question}`,id:`question-${m}`},{default:a(()=>[n(_,{vertical:"",size:"large"},{default:a(()=>[n(ae,{strong:"",style:{"font-size":"14px",color:"#666"}},{default:a(()=>[w("分值: "+L(l.score||2)+"分",1)]),_:2},1024),l.type==="single"||l.type==="judge"?(s(),f("div",ge,[n(se,{value:c.value[l.id],"onUpdate:value":o=>c.value[l.id]=o},{default:a(()=>[n(_,{vertical:""},{default:a(()=>[(s(!0),f(k,null,j(l.options,(o,B)=>(s(),y(ne,{key:B,value:M(o),label:o,size:"large"},null,8,["value","label"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])])):l.type==="multiple"?(s(),f("div",ye,[n(I,{value:d.value[l.id],"onUpdate:value":o=>d.value[l.id]=o},{default:a(()=>[n(_,{vertical:""},{default:a(()=>[(s(!0),f(k,null,j(l.options,(o,B)=>(s(),y(F,{key:B,value:M(o),label:o,size:"large"},null,8,["value","label"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])])):(s(),y(ue,{key:2,value:c.value[l.id],"onUpdate:value":o=>c.value[l.id]=o,placeholder:"请输入答案",size:"large"},null,8,["value","onUpdate:value"]))]),_:2},1024)]),_:2},1032,["title","id"]))),128))]),_:1})]),E("div",be,[n(S,{title:`答题卡 (${G.value}/${g.value.length})`,size:"small"},{default:a(()=>[n(_,{vertical:"",size:"large"},{default:a(()=>[E("div",he,[(s(!0),f(k,null,j(g.value,(l,m)=>(s(),y(T,{key:m,type:K(m)?"primary":"default",size:"medium",onClick:o=>q(m),style:{width:"100%"}},{default:a(()=>[w(L(m+1),1)]),_:2},1032,["type","onClick"]))),128))]),n(T,{type:"primary",block:"",size:"large",loading:U.value,onClick:ee},{default:a(()=>[...e[5]||(e[5]=[w(" 提交 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])])])):(s(),y(S,{key:0,title:"配置练习",style:{"margin-top":"24px"}},{default:a(()=>[n(_,{vertical:"",size:"large"},{default:a(()=>[n(h,{label:"选择科目"},{default:a(()=>[n(p,{value:v.value.subject_id,"onUpdate:value":[e[0]||(e[0]=l=>v.value.subject_id=l),X],options:Z.value,placeholder:"请选择科目",loading:z.value},null,8,["value","options","loading"])]),_:1}),n(h,{label:"题型与数量"},{default:a(()=>[n(_,{vertical:"",style:{width:"100%"}},{default:a(()=>[C.value.length===0?(s(),y(te,{key:0,type:"warning"},{default:a(()=>[...e[2]||(e[2]=[w(" 该科目下暂无题目，请先导入题目 ",-1)])]),_:1})):pe("",!0),n(I,{value:$.value,"onUpdate:value":e[1]||(e[1]=l=>$.value=l)},{default:a(()=>[n(_,{vertical:""},{default:a(()=>[(s(),f(k,null,j(Q,l=>n(_,{key:l.value,align:"center"},{default:a(()=>[n(F,{value:l.value,label:l.label,disabled:!C.value.includes(l.value)},null,8,["value","label","disabled"]),n(le,{value:v.value.question_counts[l.value],"onUpdate:value":m=>v.value.question_counts[l.value]=m,min:0,max:100,disabled:!$.value.includes(l.value),style:{width:"120px"}},{suffix:a(()=>[...e[3]||(e[3]=[w("题",-1)])]),_:1},8,["value","onUpdate:value","disabled"])]),_:2},1024)),64))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),n(T,{type:"primary",size:"large",disabled:!H.value,loading:A.value,onClick:Y,block:""},{default:a(()=>[...e[4]||(e[4]=[w(" 开始练习 ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1}))])}}};export{je as default};
