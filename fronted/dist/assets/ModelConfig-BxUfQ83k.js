import{i as H,c as y,e as p,h as r,u as J,j as Q,r as i,a as W,s as X,o as Y,b as e,w as t,d as s,G as f,f as _,g as x,l as O,F as Z,m as ee,t as g,D as te}from"./index-CLO37vWr.js";import{A as ae}from"./AddOutline-DtchF70k.js";import{T as le}from"./TrashOutline-D3PAmIE5.js";const ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},oe=r("path",{d:"M448 341.37V170.61A32 32 0 0 0 432.11 143l-152-88.46a47.94 47.94 0 0 0-48.24 0L79.89 143A32 32 0 0 0 64 170.61v170.76A32 32 0 0 0 79.89 369l152 88.46a48 48 0 0 0 48.24 0l152-88.46A32 32 0 0 0 448 341.37z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),se=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M69 153.99l187 110l187-110"},null,-1),re=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 463.99v-200"},null,-1),ue=[oe,se,re],ie=H({name:"CubeOutline",render:function(u,z){return p(),y("svg",ne,ue)}}),de={key:1,style:{display:"flex","flex-wrap":"wrap",gap:"20px","margin-top":"20px"}},_e={style:{display:"flex","align-items":"center",gap:"12px"}},pe={style:{flex:"1","font-weight":"600"}},fe={__name:"ModelConfig",setup(T){const u=J(),z=Q(),k=i(!1),h=i(!1),d=i(!1),m=i(!1),B=W(),{userId:P}=X(B),w=i([]),$=i(null),o=i({model_name:"",base_url:"",api_key:""}),U={model_name:[{required:!0,message:"请输入模型名称",trigger:"blur"}],base_url:[{required:!0,message:"请输入 API 地址",trigger:"blur"}],api_key:[{required:!0,message:"请输入 API 密钥",trigger:"blur"}]},j=l=>!l||l.length<8?"***":l.substring(0,7)+"..."+l.substring(l.length-4),b=async()=>{k.value=!0;try{w.value=await f.list(P.value)}catch(l){u.error(l.message||"加载模型配置失败")}finally{k.value=!1}},q=l=>{m.value=!0,o.value={id:l.id,model_name:l.model_name,base_url:l.base_url,api_key:l.api_key},d.value=!0},D=async()=>{var l;try{await((l=$.value)==null?void 0:l.validate()),h.value=!0,m.value?(await f.update(o.value.id,{model_name:o.value.model_name,base_url:o.value.base_url,api_key:o.value.api_key}),u.success("模型配置更新成功")):(await f.create({user_id:P.value,model_name:o.value.model_name,base_url:o.value.base_url,api_key:o.value.api_key}),u.success("模型配置添加成功")),d.value=!1,o.value={model_name:"",base_url:"",api_key:""},m.value=!1,b()}catch(a){a.message&&u.error(a.message)}finally{h.value=!1}},S=l=>{z.warning({title:"确认删除",content:"确定要删除这个模型配置吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await f.delete(l),u.success("删除成功"),b()}catch(a){u.error(a.message||"删除失败")}}})};return Y(()=>{b()}),(l,a)=>{const v=s("n-icon"),c=s("n-button"),V=s("n-page-header"),N=s("n-empty"),R=s("n-avatar"),A=s("n-space"),C=s("n-text"),E=s("n-card"),F=s("n-spin"),I=s("n-input"),M=s("n-form-item"),K=s("n-form"),L=s("n-modal");return p(),y("div",null,[e(V,{title:"AI 模型配置",subtitle:"配置你的 AI 模型（支持任何 OpenAI 兼容 API）"},{extra:t(()=>[e(c,{type:"primary",onClick:a[0]||(a[0]=n=>d.value=!0)},{icon:t(()=>[e(v,null,{default:t(()=>[e(x(ae))]),_:1})]),default:t(()=>[a[6]||(a[6]=_(" 添加模型配置 ",-1))]),_:1})]),_:1}),e(F,{show:k.value,style:{"margin-top":"24px"}},{default:t(()=>[w.value.length===0?(p(),O(N,{key:0,description:"还没有配置 AI 模型，请先添加一个配置",style:{"margin-top":"60px"}})):(p(),y("div",de,[(p(!0),y(Z,null,ee(w.value,n=>(p(),O(E,{key:n.id,hoverable:"",style:{width:"420px",height:"190px"}},{header:t(()=>[r("div",_e,[e(R,{size:"small"},{default:t(()=>[e(v,null,{default:t(()=>[e(x(ie))]),_:1})]),_:1}),r("span",pe,g(n.model_name),1)])]),"header-extra":t(()=>[e(A,{size:8},{default:t(()=>[e(c,{text:"",onClick:G=>q(n)},{default:t(()=>[e(v,{size:20},{default:t(()=>[e(x(te))]),_:1})]),_:1},8,["onClick"]),e(c,{text:"",type:"error",onClick:G=>S(n.id)},{default:t(()=>[e(v,{size:20},{default:t(()=>[e(x(le))]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),default:t(()=>[e(A,{vertical:"",size:8},{default:t(()=>[r("div",null,[e(C,{depth:"3",style:{"font-size":"13px"}},{default:t(()=>[_("API: "+g(n.base_url),1)]),_:2},1024)]),r("div",null,[e(C,{depth:"3",style:{"font-size":"13px"}},{default:t(()=>[_("Key: "+g(j(n.api_key)),1)]),_:2},1024)]),r("div",null,[e(C,{depth:"3",style:{"font-size":"13px"}},{default:t(()=>[_("创建时间: "+g(n.created_at),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))]))]),_:1},8,["show"]),e(L,{show:d.value,"onUpdate:show":a[5]||(a[5]=n=>d.value=n),preset:"dialog",title:m.value?"编辑模型配置":"添加模型配置"},{action:t(()=>[e(A,null,{default:t(()=>[e(c,{onClick:a[4]||(a[4]=n=>d.value=!1)},{default:t(()=>[...a[7]||(a[7]=[_("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:D,loading:h.value},{default:t(()=>[...a[8]||(a[8]=[_(" 确定 ",-1)])]),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(K,{ref_key:"formRef",ref:$,model:o.value,rules:U,"label-width":"100px"},{default:t(()=>[e(M,{label:"模型名称",path:"model_name"},{default:t(()=>[e(I,{value:o.value.model_name,"onUpdate:value":a[1]||(a[1]=n=>o.value.model_name=n),placeholder:"如：qwen2-7b, gpt-4"},null,8,["value"])]),_:1}),e(M,{label:"API 地址",path:"base_url"},{default:t(()=>[e(I,{value:o.value.base_url,"onUpdate:value":a[2]||(a[2]=n=>o.value.base_url=n),placeholder:"如：https://api.example.com/v1"},null,8,["value"])]),_:1}),e(M,{label:"API 密钥",path:"api_key"},{default:t(()=>[e(I,{value:o.value.api_key,"onUpdate:value":a[3]||(a[3]=n=>o.value.api_key=n),type:"password","show-password-on":"click",placeholder:"sk-xxxxxxxxxxxxxxxx"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}};export{fe as default};
